<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulut'un E-book ve Dergi Arşivi</title>
    <style>
        body {
            background-color: #121212; /* Default dark theme */
            color: white;
            font-family: sans-serif;
            margin: 0;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        #topbar {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        #left-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background-color: #333;
            color: white;
            font-weight: bold;
            transition: background-color 0.3s, color 0.3s;
        }
        #language-buttons {
            display: flex;
            gap: 10px;
        }
        #search-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        #arama {
            padding: 12px;
            width: 60%;
            min-width: 200px; /* Ensure input is usable on small screens */
            font-size: 16px;
            border-radius: 8px;
            border: none;
            outline: none;
            background-color: white;
            color: black;
            transition: background-color 0.3s;
        }
        #search-button {
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 8px;
            border: none;
            background-color: #333;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }
        #harfler {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            margin-bottom: 20px;
        }
        .harf-btn {
            padding: 8px 12px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s, color 0.3s;
        }
        .result {
            margin-top: 20px;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
        }
        .result-item {
            background-color: #1e1e1e;
            padding: 10px;
            margin: 0;
            border-bottom: 1px solid #444;
            border-radius: 6px;
            text-align: left;
            transition: background-color 0.3s, border-bottom 0.3s;
        }
        #pagination {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 20px;
        }
        .page-btn {
            padding: 8px 12px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }
        .page-btn.active {
            background-color: #555;
            font-weight: bold;
        }
        #footer {
            margin-top: 40px;
            font-size: 0.9em;
            color: #aaa;
            text-align: center;
            transition: color 0.3s;
        }
        h1 {
            text-align: center;
            margin-bottom: 5px; /* Reduced margin */
        }
        #latin-quote {
            text-align: center;
            font-size: 0.9em; /* Smaller font size */
            color: #ccc; /* Lighter color for quote */
            margin-bottom: 20px;
            font-style: italic;
        }
        /* Light theme styles */
        body.light-theme {
            background-color: #f0f0f0;
            color: black;
        }
        body.light-theme #arama {
            background-color: #e0e0e0;
        }
        body.light-theme .button,
        body.light-theme .harf-btn,
        body.light-theme #search-button,
        body.light-theme .page-btn {
            background-color: #ccc;
            color: black;
        }
        body.light-theme .page-btn.active {
            background-color: #aaa;
        }
         body.light-theme .result-item {
            background-color: #f9f9f9;
            border-bottom: 1px solid #ddd;
        }
        body.light-theme #latin-quote {
            color: #555;
        }
        body.light-theme #footer {
            color: #555;
        }
    </style>
</head>
<body>
    <div id="topbar">
        <div id="left-buttons">
            <button class="button" onclick="toggleTheme()" id="tema-btn">Tema</button>
            <button class="button" onclick="rastgeleKitapSec()" id="rastgele-kitap-btn">Rastgele Kitap</button>
            <button class="button" onclick="rastgeleDergiSec()" id="rastgele-dergi-btn">Rastgele Dergi</button>
        </div>
        <div id="language-buttons">
            <button class="button" onclick="setLang('tr')">TR</button>
            <button class="button" onclick="setLang('en')">EN</button>
        </div>
    </div>

    <h1 id="title">Bulut'un E-book ve Dergi Arşivi</h1>
    <div id="latin-quote">Legere est vitam alteram omnibus occultam habere</div>

    <div id="search-container">
        <input type="text" id="arama" placeholder="Ara...">
        <button id="search-button" onclick="performSearch()">Ara</button> <!-- Changed onclick -->
    </div>

    <div id="harfler"></div>
    <div class="result" id="sonuclar"></div>
    <div id="pagination"></div> <!-- Added pagination container -->

    <div id="footer">
        <p id="disclaimer">
            Bu sayfa sadece aradığınız kitabın Bulut'un kişisel arşivinde olup olmadığını kontrol edebilmeniz için tasarlanmıştır,
            kitabı indirmeniz mümkün değildir. İhtiyacınız olan kitaba ulaştıktan sonra, baskısı varsa orijinalini satın almanız rica edilir.
        </p>
        <p id="contact-info">İletişim: bulut.unvan@gmail.com</p>
    </div>

    <script>
    let kitaplar = []; // Initialize as empty, will be loaded from JSON
    let currentFilteredList = []; // Holds the full list of currently filtered items
    let currentPage = 1;
    const itemsPerPage = 25;

    let currentLang = localStorage.getItem("language") || "tr";
    let currentTheme = localStorage.getItem("theme") || "dark"; // Default to dark

    const translations = {
        "tr": {
            title: "Bulut E-kitap ve Dergi Arşivi",
            placeholder: "Ara...",
            disclaimer: "Bu sayfa sadece aradığınız kitabın Bulut\"un kişisel arşivinde olup olmadığını kontrol edebilmeniz için tasarlanmıştır, kitabı indirmeniz mümkün değildir. İhtiyacınız olan kitaba ulaştıktan sonra, baskısı varsa orijinalini satın almanız rica edilir.",
            contact: "İletişim: bulut.unvan@gmail.com",
            noResults: "Sonuç bulunamadı.",
            noMagazines: "Uygun dergi bulunamadı.",
            noBooks: "Uygun kitap bulunamadı.",
            theme: "Tema",
            randomBookButton: "Rastgele Kitap",
            randomMagazineButton: "Rastgele Dergi",
            search: "Ara",
            alphabet: "ABCÇDEFGHIİJKLMNOÖPQRSŞTUÜVWXYZ",
        },
        "en": {
            title: "Bulut\"s E-book and Magazine Archive",
            placeholder: "Search...",
            disclaimer: "This page is designed solely to check whether the book you are looking for exists in Bulut\"s personal archive; downloading is not possible. If you find the book you need, please purchase the original if it\"s in print.",
            contact: "Contact: bulut.unvan@gmail.com",
            noResults: "No results found.",
            noMagazines: "No suitable magazines found.",
            noBooks: "No suitable books found.",
            theme: "Theme",
            randomBookButton: "Random Book",
            randomMagazineButton: "Random Magazine",
            search: "Search",
            alphabet: "ABCÇDEFGHIİJKLMNOÖPQRSŞTUÜVWXYZ",
        }
    };

    // --- DOM Elements ---
    const sonuclarDiv = document.getElementById("sonuclar");
    const paginationDiv = document.getElementById("pagination");
    const aramaInput = document.getElementById("arama");
    const harflerDiv = document.getElementById("harfler");
    const titleElement = document.getElementById("title");
    const latinQuoteElement = document.getElementById("latin-quote"); // Added quote element
    const disclaimerElement = document.getElementById("disclaimer");
    const contactInfoElement = document.getElementById("contact-info");
    const temaBtn = document.getElementById("tema-btn");
    const rastgeleKitapBtn = document.getElementById("rastgele-kitap-btn");
    const rastgeleDergiBtn = document.getElementById("rastgele-dergi-btn");
    const searchButton = document.getElementById("search-button");

    // --- Functions ---
    function setLangUIOnly(langCode) {
        currentLang = langCode;
        localStorage.setItem("language", currentLang);
        const t = translations[currentLang];

        titleElement.textContent = t.title;
        // Latin quote remains the same regardless of language
        aramaInput.placeholder = t.placeholder;
        disclaimerElement.textContent = t.disclaimer;
        contactInfoElement.textContent = t.contact;
        temaBtn.textContent = t.theme;
        rastgeleKitapBtn.textContent = t.randomBookButton;
        rastgeleDergiBtn.textContent = t.randomMagazineButton;
        searchButton.textContent = t.search;
        // DO NOT render harfler here
        aramaInput.value = ""; // Clear search input
        sonuclarDiv.innerHTML = ""; // Clear results
        paginationDiv.innerHTML = ""; // Clear pagination
    }

    function setLang(langCode) {
        setLangUIOnly(langCode); // Update UI texts
        if (kitaplar.length > 0) { // Only render if data is loaded
             renderHarfler(); // Regenerate alphabet buttons
        }
        // Clear results and pagination
        currentFilteredList = [];
        currentPage = 1;
        goster([]);
    }

    function renderPaginationControls(totalItems) {
        paginationDiv.innerHTML = "";
        const totalPages = Math.ceil(totalItems / itemsPerPage);

        if (totalPages <= 1) return; // No pagination needed for 1 or 0 pages

        for (let i = 1; i <= totalPages; i++) {
            const button = document.createElement("button");
            button.className = "page-btn";
            button.textContent = i;
            if (i === currentPage) {
                button.classList.add("active");
            }
            button.onclick = () => {
                currentPage = i;
                goster(currentFilteredList); // Re-render results for the new page
            };
            paginationDiv.appendChild(button);
        }
        applyThemeToPagination(); // Apply theme to pagination buttons
    }

    function goster(fullList, messageKey = "noResults", isRandom = false) {
        sonuclarDiv.innerHTML = "";
        paginationDiv.innerHTML = ""; // Clear pagination initially

        if (isRandom) {
            // Handle single random item display (no pagination)
            if (!fullList || fullList.length === 0) {
                 sonuclarDiv.innerHTML = `<p>${translations[currentLang][messageKey]}</p>`;
            } else {
                const itemDiv = document.createElement("div");
                itemDiv.className = "result-item";
                itemDiv.textContent = fullList[0]; // Show the single random item
                sonuclarDiv.appendChild(itemDiv);
                applyThemeToResults();
            }
        } else {
            // Handle list display with pagination
            currentFilteredList = fullList; // Store the full list for pagination
            if (!fullList || fullList.length === 0) {
                sonuclarDiv.innerHTML = `<p>${translations[currentLang][messageKey]}</p>`;
            } else {
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const pageItems = fullList.slice(startIndex, endIndex);

                pageItems.forEach((k, index) => {
                    const itemDiv = document.createElement("div");
                    itemDiv.className = "result-item";
                    // Calculate the overall item number
                    const itemNumber = startIndex + index + 1;
                    itemDiv.textContent = `${itemNumber}. ${k}`;
                    sonuclarDiv.appendChild(itemDiv);
                });

                applyThemeToResults();
                renderPaginationControls(fullList.length);
            }
        }
    }

    function rastgeleKitapSec() {
        const sayiRegex = new RegExp("(^|\\W)Sayı(\\W|$)", "i");
        const uygunKitaplar = kitaplar.filter(kitap => !sayiRegex.test(kitap));
        if (uygunKitaplar.length === 0) {
            goster([], "noBooks", true);
            return;
        }
        const rastgele = uygunKitaplar[Math.floor(Math.random() * uygunKitaplar.length)];
        currentPage = 1; // Reset page
        goster([rastgele], "noBooks", true);
    }

    function rastgeleDergiSec() {
        const sayiRegex = new RegExp("(^|\\W)Sayı(\\W|$)", "i");
        const uygunDergiler = kitaplar.filter(kitap => sayiRegex.test(kitap));
        if (uygunDergiler.length === 0) {
            goster([], "noMagazines", true);
            return;
        }
        const rastgele = uygunDergiler[Math.floor(Math.random() * uygunDergiler.length)];
        currentPage = 1; // Reset page
        goster([rastgele], "noMagazines", true);
    }

    function performFilter(filterFn) {
        const filtered = kitaplar.filter(filterFn);
        currentPage = 1; // Reset to first page for new filter/search
        goster(filtered);
    }

    function harfFiltrele(harf) {
        const normalizedHarf = harf.toLocaleUpperCase(currentLang);
        performFilter(k => {
            if (!k) return false;
            const firstChar = k.trim().charAt(0).toLocaleUpperCase(currentLang);
            return firstChar === normalizedHarf;
        });
    }

    function performSearch() {
        const query = aramaInput.value.toLocaleLowerCase(currentLang).trim();
        if (query === "") {
            currentPage = 1;
            goster([]); // Show empty results if query is empty
            return;
        }
        performFilter(k => k && k.toLocaleLowerCase(currentLang).includes(query));
    }

    function applyTheme() {
        if (currentTheme === "light") {
            document.body.classList.add("light-theme");
        } else {
            document.body.classList.remove("light-theme");
        }
        applyThemeToResults();
        applyThemeToPagination();
        applyThemeToHarfler();
    }

    function applyThemeToResults() {
        // Styles are handled by CSS classes, this might be redundant
    }
    function applyThemeToPagination() {
        // Styles are handled by CSS classes, this might be redundant
    }
    function applyThemeToHarfler(){
         // Styles are handled by CSS classes, this might be redundant
    }

    function toggleTheme() {
        currentTheme = currentTheme === "dark" ? "light" : "dark";
        localStorage.setItem("theme", currentTheme);
        applyTheme();
    }

    function renderHarfler() {
        harflerDiv.innerHTML = "";
        const alphabet = translations[currentLang].alphabet;
        for (const harf of alphabet) {
            const button = document.createElement("button");
            button.className = "harf-btn";
            button.textContent = harf;
            button.onclick = () => harfFiltrele(harf);
            harflerDiv.appendChild(button);
        }
        applyThemeToHarfler();
    }

    function debounce(func, delay) {
        let timeout;
        return function(...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), delay);
        };
    }

    // --- Initial Setup ---
    document.addEventListener("DOMContentLoaded", () => {
        setLangUIOnly(currentLang);
        applyTheme();

        aramaInput.disabled = true;
        searchButton.disabled = true;
        harflerDiv.style.display = 'none';
        document.querySelectorAll('#rastgele-kitap-btn, #rastgele-dergi-btn').forEach(btn => btn.disabled = true);

        fetch('kitaplar.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                kitaplar = data;
                console.log('Kitaplar loaded:', kitaplar.length);
                renderHarfler();
                harflerDiv.style.display = 'flex';
                aramaInput.disabled = false;
                searchButton.disabled = false;
                document.querySelectorAll('#rastgele-kitap-btn, #rastgele-dergi-btn').forEach(btn => btn.disabled = false);

                // Debounced search on input
                const debouncedSearch = debounce(performSearch, 300);
                aramaInput.addEventListener("input", debouncedSearch);

                // Search on Enter key
                aramaInput.addEventListener("keypress", function(event) {
                    if (event.key === "Enter") {
                        event.preventDefault();
                        performSearch(); // Use the same search function
                    }
                });

            })
            .catch(error => {
                console.error('Error fetching kitaplar.json:', error);
                sonuclarDiv.innerHTML = '<p>Error loading book list.</p>';
            });
    });

    </script>
</body>
</html>
